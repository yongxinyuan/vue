<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>observe</title>
  </head>
  <body>
    <script>
      const { Dep, pushTarget, popTarget } = (() => {
        let uid = 0;

        class Dep {
          constructor() {
            this.id = uid++;
            this.subs = [];
          }

          addSub(sub) {
            this.sub.push(sub);
          }

          removeSub(sub) {
            if (this.subs.length) {
              const index = this.subs.indexOf(sub);
              if (index > -1) {
                this.subs = this.subs.splice(index, 1);
              }
            }
          }

          depend() {
            if (Dep.target) {
              Dep.target.addDep(this);
            }
          }

          notify() {
            const subs = this.subs.slice();

            for (let i = 0, len = subs.length; i < len; i++) {
              subs[i].update();
            }
          }
        }

        const targetStack = [];

        function pushTarget(target) {
          targetStack.push(target);
          Dep.target = target;
        }

        function popTarget() {
          targetStack.pop();
          Dep.target = targetStack[targetStack.length - 1];
        }

        return { Dep, pushTarget, popTarget };
      })();

      const { Watcher } = (() => {
        class Watcher {
          get() {}

          addDep() {}

          cleanupDeps() {}

          update() {}

          run() {}

          evaluate() {}

          depend() {}

          teardown() {}
        }

        return { Watcher };
      })();

      const { Observer } = (() => {
        class Observer {
          constructor(value) {
            this.value = value;
            this.dep = new Dep();

            if (Array.isArray(value)) {
              this.observeArray(value);
            } else {
              this.walk(value);
            }
          }

          walk(obj) {}

          observeArray(items) {}
        }

        return { Observer };
      })();

      //
    </script>
  </body>
</html>
